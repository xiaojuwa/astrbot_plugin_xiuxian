# AstrBot 文字修仙插件

<p align="center">
  <img src="https://img.shields.io/badge/版本-v2.5.0-blue" alt="Version">
  <img src="https://img.shields.io/badge/框架-AstrBot-green" alt="Framework">
  <img src="https://img.shields.io/badge/数据库版本-v14-orange" alt="DB Version">
  <img src="https://img.shields.io/badge/许可证-AGPL--3.0-red" alt="License">
</p>

一款为 AstrBot 设计的放置类文字修仙游戏插件。从凡人踏入仙途，历经修炼、战斗、探索，终成大道！

> 感谢 [@Zhalslar](https://github.com/Zhalslar) 提供的模块化思路重构了整个插件的结构

---

## 特色功能

| 特色 | 描述 |
|------|------|
| **完整成长体验** | 28级境界体系，从"炼气一层"到"祭道之上" |
| **动态战斗系统** | 基于标签系统动态生成怪物和Boss，每次战斗独一无二 |
| **丰富物品系统** | 60+ 种物品，涵盖丹药、材料、法器、功法 |
| **炼丹/炼器系统** | 收集材料炼制丹药和法器，10级炼丹师/炼器师等级 |
| **宗门社交** | 创建或加入宗门，与道友共谋发展 |
| **多元化玩法** | 排行榜、每日任务、奇遇探索、天劫挑战、悬赏任务 |
| **高度可配置** | 所有数值、物品、怪物、配方均可通过JSON文件自定义 |
| **专业数据管理** | aiosqlite独立存储 + 版本化数据库迁移系统 |

---

## 快速开始

### 安装

1. 在 AstrBot 插件市场搜索 `astrbot_plugin_xiuxian` 安装
2. 或手动克隆到 `AstrBot/data/plugins/` 目录

### 开启修仙之路

```
发送: 我要修仙    → 创建角色
发送: 修仙帮助    → 查看所有指令
发送: 签到        → 领取每日奖励
```

---

## 游戏指令大全

### 入门指引

| 指令 | 说明 |
|:-----|:-----|
| `我要修仙` | 开启修仙之旅，创建角色 |
| `我的信息` | 查看人物详细信息（境界、属性、装备） |
| `签到` | 每日签到，0点刷新 |
| `修仙帮助` | 显示完整帮助信息 |

### 修炼成长

| 指令 | 说明 |
|:-----|:-----|
| `闭关` | 开始闭关修炼（离线挂机） |
| `出关` | 结束闭关，结算修为收益 |
| `突破` | 尝试突破当前境界（需足够修为） |
| `重入仙途` | 花费灵石重置灵根 |

### 坊市物品

| 指令 | 说明 |
|:-----|:-----|
| `商店` | 查看今日坊市商品（每日随机刷新） |
| `我的背包` | 查看背包物品 |
| `购买 <物品名> [数量]` | 购买商品，默认1个 |
| `使用 <物品名> [数量]` | 使用消耗品/装备法器 |
| `出售 <物品名> [数量]` | 出售物品给商店（每日5次，40%价格） |
| `我的装备` | 查看当前装备 |
| `卸下 <部位>` | 卸下装备（武器/防具/饰品） |

### 炼丹/炼器系统 (v2.4.0新增)

| 指令 | 说明 |
|:-----|:-----|
| `炼丹` | 查看炼丹界面（丹炉等级、可用配方） |
| `炼丹 <配方名>` | 炼制丹药 |
| `炼器` | 查看炼器界面（炼器台等级、可用配方） |
| `炼器 <配方名>` | 炼制法器 |
| `升级丹炉` | 升级丹炉（提升成功率和品质） |
| `升级炼器台` | 升级炼器台 |
| `配方 <配方名>` | 查看配方详情（材料、成功率） |
| `配方图鉴` | 查看所有配方列表 |
| `材料图鉴` | 查看所有材料及获取途径 |

### 宗门社交

| 指令 | 说明 |
|:-----|:-----|
| `创建宗门 <宗门名>` | 创建宗门（需要灵石） |
| `加入宗门 <宗门名>` | 加入已有宗门 |
| `我的宗门` | 查看宗门信息 |
| `退出宗门` | 退出当前宗门 |
| `宗门捐献 <数额>` | 向宗门捐献灵石，获得贡献度 |

### 战斗探险

| 指令 | 说明 |
|:-----|:-----|
| `切磋 @某人` | 与其他玩家切磋（需双方满血） |
| `奇斗 @某人 <灵石>` | 带灵石赌注的PVP（胜者赢得灵石） |
| `查看世界boss` | 查看当前活跃的世界Boss |
| `讨伐boss <Boss ID>` | 挑战世界Boss |
| `探索秘境` | 进入秘境探索 |
| `前进` | 在秘境中前进一层 |
| `离开秘境` | 离开当前秘境 |

### 排行榜

| 指令 | 说明 |
|:-----|:-----|
| `境界排行` | 查看境界排行榜 |
| `财富排行` | 查看灵石排行榜 |
| `战力排行` | 查看综合战力排行榜 |
| `PVP排行` | 查看PVP胜场/胜率排行榜 |
| `我的排名` | 查看个人在各榜单的排名 |

### 每日任务

| 指令 | 说明 |
|:-----|:-----|
| `每日任务` | 查看每日任务进度 |
| `领取任务奖励` | 领取完成的任务奖励 |

> 每日5个任务：闭关、签到、秘境探索、Boss讨伐、切磋，全部完成可领取500灵石全勤奖励

### 奇遇探索

| 指令 | 说明 |
|:-----|:-----|
| `奇遇` | 触发一次奇遇（每日3次） |
| `奇遇状态` | 查看今日奇遇次数 |

### 天劫系统

| 指令 | 说明 |
|:-----|:-----|
| `天劫信息` | 查看天劫信息 |
| `渡劫` | 挑战天劫 |

### 悬赏任务

| 指令 | 说明 |
|:-----|:-----|
| `悬赏榜` | 查看悬赏任务列表 |
| `接取悬赏 <任务名>` | 接取并执行悬赏任务 |
| `悬赏状态` | 查看悬赏完成状态 |

### 交易系统

| 指令 | 说明 |
|:-----|:-----|
| `转账 @某人 <数额>` | 转账灵石给其他玩家（5%税率） |
| `赠送 @某人 <物品> [数量]` | 赠送物品给其他玩家 |
| `我的功法` | 查看已学习的功法及属性加成 |
| `我的buff` | 查看当前激活的战斗buff |

### GM管理员指令 (v2.5.0新增)

> 以下指令仅限管理员使用，用于游戏数据管理和调试

| 指令 | 说明 |
|:-----|:-----|
| `GM加灵石 @玩家 <数额>` | 为玩家增加/扣除灵石（负数为扣除） |
| `GM加修为 @玩家 <数额>` | 为玩家增加/扣除修为 |
| `GM设境界 @玩家 <境界索引>` | 设置玩家境界（使用`GM境界列表`查看索引） |
| `GM加物品 @玩家 <物品名> [数量]` | 为玩家添加物品 |
| `GM设生命 @玩家 <数值>` | 设置玩家当前生命值 |
| `GM重置玩家 @玩家` | 重置玩家所有数据 |
| `GM查看玩家 @玩家` | 查看玩家详细信息 |
| `GM境界列表` | 查看所有境界及索引 |
| `GM物品列表 [类型]` | 查看物品列表（可选类型筛选） |
| `GM清状态 @玩家` | 清除玩家状态（解除闭关/秘境等） |

### 激活码系统 (v2.5.0新增)

| 指令 | 说明 |
|:-----|:-----|
| `橘的恩赐 <激活码>` | 使用激活码领取奖励 |

> 激活码由管理员在WebUI后台配置，可设置：激活码内容（支持中文）、最大使用次数、赠送灵石/修为/物品

---

## 游戏机制

### 灵根系统

| 灵根 | 修炼速度 |
|------|---------|
| 五行灵根(金/木/水/火/土) | 1.0x |
| 变异灵根 | 1.2x |
| 天灵根 | 1.5x |
| 融合灵根 | 1.8x |
| 混沌灵根 | 2.0x |

### 境界体系

```
炼气期(5层) → 筑基期(3期) → 搬血境 → 洞天境 → 化灵境 → 铭纹境 → 
列阵境 → 尊者境 → 神火境 → 真一境 → 圣祭境 → 天神境 → 虚道境 → 
斩我境 → 遁一境 → 至尊境 → 真仙境 → 仙王境 → 准仙帝 → 仙帝境 → 祭道境 → 祭道之上
```

### 炼丹/炼器系统

**炼丹师/炼器师等级：**
| 等级 | 称号 | 所需熟练度 |
|------|------|-----------|
| 1级 | 学徒 | 0 |
| 2级 | 初窥门径 | 100 |
| 3级 | 小有所成 | 300 |
| 4级 | 登堂入室 | 600 |
| 5级 | 炉火纯青 | 1000 |
| 6级 | 出神入化 | 1500 |
| 7级 | 宗师 | 2200 |
| 8级 | 大宗师 | 3000 |
| 9级 | 丹圣/器圣 | 4000 |
| 10级 | 丹帝/器帝 | 5500 |

**丹炉/炼器台等级：**
| 等级 | 名称 | 成功率加成 | 品质加成 |
|------|------|-----------|----------|
| 1级 | 凡铁丹炉/简易炼器台 | +0% | +0% |
| 2级 | 青铜丹炉/精工炼器台 | +5% | +5% |
| 3级 | 紫金丹炉/天工炼器台 | +10% | +10% |
| 4级 | 玄天丹炉/神匠炼器台 | +18% | +18% |
| 5级 | 太上丹炉/造化炼器台 | +30% | +30% |

**品质系统：**
| 品质 | 概率 | 效果倍率 |
|------|------|----------|
| 残次 | 15% | 0.7x |
| 普通 | 45% | 1.0x |
| 精良 | 25% | 1.3x |
| 完美 | 12% | 1.6x |
| 传说 | 3% | 2.0x |

### 材料获取途径

| 途径 | 可获得材料品级 |
|------|---------------|
| 商店 | 凡品 |
| 秘境怪物 | 凡品+珍品 |
| Boss掉落 | 珍品+圣品 |
| 奇遇 | 随机 |
| 悬赏任务 | 指定材料 |

---

## 配置说明

### WebUI 配置

通过 AstrBot WebUI 的插件配置页面可调整：

| 配置项 | 描述 |
|--------|------|
| `ACCESS_CONTROL.WHITELIST_GROUPS` | 白名单群号列表，留空表示所有群可用 |
| `VALUES.INITIAL_GOLD` | 新玩家初始灵石数量 |
| `VALUES.CHECK_IN_REWARD_MIN/MAX` | 签到奖励范围 |
| `VALUES.BASE_EXP_PER_MINUTE` | 闭关每分钟获得的基础修为 |
| `VALUES.CREATE_SECT_COST` | 创建宗门消耗灵石 |
| `VALUES.SHOP_DAILY_ITEM_COUNT` | 每日商店刷新商品数量 |
| `SPIRIT_ROOT_SPEEDS.*` | 各灵根修炼速度倍率 |

### 配置文件

| 文件 | 用途 |
|------|------|
| `config/level_config.json` | 境界配置（名称、升级修为、成功率） |
| `config/items.json` | 物品配置（名称、价格、效果） |
| `config/monsters.json` | 怪物模板配置 |
| `config/bosses.json` | Boss模板配置 |
| `config/tags.json` | 怪物标签系统（属性修饰、掉落） |
| `config/recipes.json` | 炼丹/炼器配方配置 |

---

## 项目结构

```
astrbot_plugin_xiuxian/
├── main.py                 # 主入口，注册所有指令
├── models.py               # 数据模型（Player, Item, Monster等）
├── config_manager.py       # 配置加载管理器
├── handlers/               # 指令处理器
│   ├── player_handler.py   # 玩家相关
│   ├── shop_handler.py     # 商店/背包/出售
│   ├── combat_handler.py   # 战斗
│   ├── sect_handler.py     # 宗门
│   ├── realm_handler.py    # 秘境
│   ├── crafting_handler.py # 炼丹/炼器
│   └── ...
├── core/                   # 核心业务逻辑
│   ├── cultivation_manager.py  # 修炼管理
│   ├── combat_manager.py       # 战斗计算
│   ├── realm_manager.py        # 秘境生成
│   ├── sect_manager.py         # 宗门管理
│   └── crafting_manager.py     # 炼丹/炼器管理
├── data/                   # 数据层
│   ├── data_manager.py     # 数据库操作
│   └── migration.py        # 数据库迁移（v13）
└── config/                 # 游戏配置JSON
    ├── items.json          # 物品配置
    ├── recipes.json        # 配方配置
    └── ...
```

---

## 数据库

- **存储引擎**：SQLite (aiosqlite异步)
- **数据库版本**：v13
- **存储位置**：`AstrBot/data/xiuxian/xiuxian_data.db`
- **自动迁移**：插件升级时自动执行数据库迁移

---

## 更新日志

### v2.5.0 (最新)

**新增系统：**
- **GM管理员工具**：完整的游戏数据管理指令集
  - 灵石/修为增减
  - 境界设置
  - 物品添加
  - 生命值设置
  - 玩家数据重置
  - 玩家详情查看
  - 状态清除（解除闭关/秘境卡住）
- **激活码系统（橘的恩赐）**：玩家补偿/福利发放系统
  - 支持中文激活码
  - 可配置最大使用次数
  - 可赠送灵石、修为、物品
  - WebUI后台可视化配置

**新增指令：**
- `GM加灵石 @玩家 <数额>` - 增减灵石
- `GM加修为 @玩家 <数额>` - 增减修为
- `GM设境界 @玩家 <索引>` - 设置境界
- `GM加物品 @玩家 <物品名> [数量]` - 添加物品
- `GM设生命 @玩家 <数值>` - 设置生命值
- `GM重置玩家 @玩家` - 重置玩家数据
- `GM查看玩家 @玩家` - 查看详细信息
- `GM境界列表` - 查看境界索引
- `GM物品列表 [类型]` - 查看物品列表
- `GM清状态 @玩家` - 清除玩家状态
- `橘的恩赐 <激活码>` - 使用激活码领取奖励

### v2.4.0

**新增系统：**
- **炼丹系统**：收集材料炼制丹药，16种丹药配方
- **炼器系统**：收集材料锻造法器，18种炼器配方
- **炼丹师/炼器师等级**：10级等级体系，提升成功率
- **丹炉/炼器台升级**：5级升级体系，提升成功率和品质
- **品质系统**：残次/普通/精良/完美/传说五种品质
- **物品出售**：每日5次回购机会，40%价格出售物品

**新增物品：**
- 24种新材料（灵芝草、火灵草、寒玉花、聚气草等）
- 6种新丹药（虎力丹、铁皮丹、金钟丹等）
- 7种新法器（玄铁刀、灵蚕袍、聚灵珠等）

**新增指令：**
- `炼丹 [配方名]` - 炼丹界面/炼制丹药
- `炼器 [配方名]` - 炼器界面/炼制法器
- `升级丹炉` - 升级丹炉
- `升级炼器台` - 升级炼器台
- `配方 <配方名>` - 查看配方详情
- `配方图鉴` - 查看所有配方
- `材料图鉴` - 查看所有材料
- `出售 <物品名> [数量]` - 出售物品

**优化改进：**
- 怪物掉落增加装备和功法
- 材料现在有实际用途（炼丹/炼器）
- 物品获取途径更加多样化

### v2.3.0

**新增系统：**
- 功法系统：学习功法永久提升攻击/防御/生命
- Buff系统：丹药提供临时战斗加成
- 奇斗系统：带灵石赌注的PVP
- 玩家交易：支持转账灵石和赠送物品
- 宗门捐献：贡献灵石获得宗门贡献度
- PVP排行：新增胜场/胜率排行榜

### v2.2.0

**新增系统：**
- 排行榜系统（境界/财富/战力三榜）
- 每日任务系统（5任务+全勤奖励）
- 奇遇系统（每日3次，10种奇遇事件）
- 天劫系统（4重天劫挑战）
- 悬赏任务系统（7种难度）

---

## 后续规划

- [ ] **宗门扩展**：宗门任务、宗门仓库、宗门等级
- [ ] **灵宠系统**：捕捉、培养、战斗辅助
- [ ] **洞府系统**：个人洞府、灵田种植
- [x] **管理员工具**：GM指令修改游戏数据 ✅ v2.5.0已实现
- [ ] **钱庄系统**：灵石存储利息

---

## 贡献

欢迎通过以下方式贡献：

- 提交 Issue 报告 Bug
- 提出功能建议
- 提交 Pull Request

---

## 许可证

本项目采用 [AGPL-3.0](LICENSE) 许可证开源。
