# 🌟 AstrBot 文字修仙插件

<p align="center">
  <img src="https://img.shields.io/badge/版本-v2.3.0-blue" alt="Version">
  <img src="https://img.shields.io/badge/框架-AstrBot-green" alt="Framework">
  <img src="https://img.shields.io/badge/数据库版本-v11-orange" alt="DB Version">
  <img src="https://img.shields.io/badge/许可证-AGPL--3.0-red" alt="License">
</p>

一款为 AstrBot 设计的放置类文字修仙游戏插件。从凡人踏入仙途，历经修炼、战斗、探索，终成大道！

> 感谢 [@Zhalslar](https://github.com/Zhalslar) 提供的模块化思路重构了整个插件的结构

---

## ✨ 特色功能

| 特色 | 描述 |
|------|------|
| 🎮 **完整成长体验** | 28级境界体系，从"炼气一层"到"祭道之上" |
| ⚔️ **动态战斗系统** | 基于标签系统动态生成怪物和Boss，每次战斗独一无二 |
| 🏪 **丰富物品系统** | 40+ 种物品，涵盖丹药、材料、法器、功法 |
| 🏛️ **宗门社交** | 创建或加入宗门，与道友共谋发展 |
| 🏆 **多元化玩法** | 排行榜、每日任务、奇遇探索、天劫挑战、悬赏任务 |
| ⚙️ **高度可配置** | 所有数值、物品、怪物均可通过JSON文件自定义 |
| 💾 **专业数据管理** | aiosqlite独立存储 + 版本化数据库迁移系统 |
| 🎲 **v2.3.0新增** | 功法学习、丹药Buff、奇斗赌注、玩家交易、宗门捐献 |

---

## 🚀 快速开始

### 安装

1. 在 AstrBot 插件市场搜索 `astrbot_plugin_xiuxian` 安装
2. 或手动克隆到 `AstrBot/data/plugins/` 目录

### 开启修仙之路

```
发送: 我要修仙    → 创建角色
发送: 修仙帮助    → 查看所有指令
发送: 签到        → 领取每日奖励
```

---

## 📖 游戏指令大全

### 🎯 入门指引

| 指令 | 说明 |
|:-----|:-----|
| `我要修仙` | 开启修仙之旅，创建角色 |
| `我的信息` | 查看人物详细信息（境界、属性、装备） |
| `签到` | 每日签到，0点刷新 |
| `修仙帮助` | 显示完整帮助信息 |

### 🧘 修炼成长

| 指令 | 说明 |
|:-----|:-----|
| `闭关` | 开始闭关修炼（离线挂机） |
| `出关` | 结束闭关，结算修为收益 |
| `突破` | 尝试突破当前境界（需足够修为） |
| `重入仙途` | 花费灵石重置灵根 |

### 🏪 坊市物品

| 指令 | 说明 |
|:-----|:-----|
| `商店` | 查看今日坊市商品（每日随机刷新） |
| `我的背包` | 查看背包物品 |
| `购买 <物品名> [数量]` | 购买商品，默认1个 |
| `使用 <物品名> [数量]` | 使用消耗品/装备法器 |
| `我的装备` | 查看当前装备 |
| `卸下 <部位>` | 卸下装备（武器/防具/饰品） |

### 🏛️ 宗门社交

| 指令 | 说明 |
|:-----|:-----|
| `创建宗门 <宗门名>` | 创建宗门（需要灵石） |
| `加入宗门 <宗门名>` | 加入已有宗门 |
| `我的宗门` | 查看宗门信息 |
| `退出宗门` | 退出当前宗门 |

### ⚔️ 战斗探险

| 指令 | 说明 |
|:-----|:-----|
| `切磋 @某人` | 与其他玩家切磋（需双方满血） |
| `查看世界boss` | 查看当前活跃的世界Boss |
| `讨伐boss <Boss ID>` | 挑战世界Boss |
| `探索秘境` | 进入秘境探索 |
| `前进` | 在秘境中前进一层 |
| `离开秘境` | 离开当前秘境 |

### 🏆 排行榜

| 指令 | 说明 |
|:-----|:-----|
| `境界排行` | 查看境界排行榜 |
| `财富排行` | 查看灵石排行榜 |
| `战力排行` | 查看综合战力排行榜 |
| `我的排名` | 查看个人在各榜单的排名 |

### 📋 每日任务

| 指令 | 说明 |
|:-----|:-----|
| `每日任务` | 查看每日任务进度 |
| `领取任务奖励` | 领取完成的任务奖励 |

> 每日5个任务：闭关、签到、秘境探索、Boss讨伐、切磋，全部完成可领取500灵石全勤奖励

### 🌈 奇遇探索

| 指令 | 说明 |
|:-----|:-----|
| `奇遇` | 触发一次奇遇（每日3次） |
| `奇遇状态` | 查看今日奇遇次数 |

> 包含8种普通奇遇和2种稀有奇遇，奖励随境界提升

### ⚡ 天劫系统

| 指令 | 说明 |
|:-----|:-----|
| `天劫信息` | 查看天劫信息 |
| `渡劫` | 挑战天劫 |

> 高境界修士需渡过天劫方可继续突破，共4重天劫，难度递增

### 📜 悬赏任务

| 指令 | 说明 |
|:-----|:-----|
| `悬赏榜` | 查看悬赏任务列表 |
| `接取悬赏 <任务名>` | 接取并执行悬赏任务 |
| `悬赏状态` | 查看悬赏完成状态 |

> 7种不同难度的悬赏任务，每日可完成5次

### ⚔️ v2.3.0 新增 - 奇斗与交易

| 指令 | 说明 |
|:-----|:-----|
| `奇斗 @某人 <灵石>` | 带灵石赌注的PVP（胜者赢得灵石） |
| `PVP排行` | 查看PVP胜场/胜率排行榜 |
| `转账 @某人 <数额>` | 转账灵石给其他玩家（5%税率） |
| `赠送 @某人 <物品> [数量]` | 赠送物品给其他玩家 |
| `宗门捐献 <数额>` | 向宗门捐献灵石，获得贡献度 |
| `我的功法` | 查看已学习的功法及属性加成 |
| `我的buff` | 查看当前激活的战斗buff |

> 使用功法类物品可永久获得属性加成，丹药(如筑基丹、大力丸)可获得临时战斗buff

---

## 🎮 游戏机制

### 灵根系统

| 灵根 | 修炼速度 |
|------|---------|
| 五行灵根(金/木/水/火/土) | 1.0x |
| 变异灵根 | 1.2x |
| 天灵根 | 1.5x |
| 融合灵根 | 1.8x |
| 混沌灵根 | 2.0x |

### 境界体系

```
炼气期(5层) → 筑基期(3期) → 搬血境 → 洞天境 → 化灵境 → 铭纹境 → 
列阵境 → 尊者境 → 神火境 → 真一境 → 圣祭境 → 天神境 → 虚道境 → 
斩我境 → 遁一境 → 至尊境 → 真仙境 → 仙王境 → 准仙帝 → 仙帝境 → 祭道境 → 祭道之上
```

### 战斗属性

- **生命值(HP)**：境界越高，基础生命越高
- **攻击力**：决定伤害输出
- **防御力**：减少受到的伤害

属性公式：`最终属性 = 基础属性 + 装备加成`

---

## ⚙️ 配置说明

### WebUI 配置

通过 AstrBot WebUI 的插件配置页面可调整：

| 配置项 | 描述 |
|--------|------|
| `ACCESS_CONTROL.WHITELIST_GROUPS` | 白名单群号列表，留空表示所有群可用 |
| `VALUES.INITIAL_GOLD` | 新玩家初始灵石数量 |
| `VALUES.CHECK_IN_REWARD_MIN/MAX` | 签到奖励范围 |
| `VALUES.BASE_EXP_PER_MINUTE` | 闭关每分钟获得的基础修为 |
| `VALUES.CREATE_SECT_COST` | 创建宗门消耗灵石 |
| `VALUES.SHOP_DAILY_ITEM_COUNT` | 每日商店刷新商品数量 |
| `SPIRIT_ROOT_SPEEDS.*` | 各灵根修炼速度倍率 |

### 配置文件

| 文件 | 用途 |
|------|------|
| `config/level_config.json` | 境界配置（名称、升级修为、成功率） |
| `config/items.json` | 物品配置（名称、价格、效果） |
| `config/monsters.json` | 怪物模板配置 |
| `config/bosses.json` | Boss模板配置 |
| `config/tags.json` | 怪物标签系统（属性修饰、掉落） |

---

## 🗂️ 项目结构

```
astrbot_plugin_xiuxian/
├── main.py                 # 主入口，注册所有指令
├── models.py               # 数据模型（Player, Item, Monster等）
├── config_manager.py       # 配置加载管理器
├── handlers/               # 指令处理器（12个模块）
│   ├── player_handler.py   # 玩家相关
│   ├── shop_handler.py     # 商店/背包
│   ├── combat_handler.py   # 战斗
│   ├── sect_handler.py     # 宗门
│   ├── realm_handler.py    # 秘境
│   └── ...
├── core/                   # 核心业务逻辑
│   ├── cultivation_manager.py  # 修炼管理
│   ├── combat_manager.py       # 战斗计算
│   ├── realm_manager.py        # 秘境生成
│   └── sect_manager.py         # 宗门管理
├── data/                   # 数据层
│   ├── data_manager.py     # 数据库操作
│   └── migration.py        # 数据库迁移（v10）
└── config/                 # 游戏配置JSON
```

---

## 📦 数据库

- **存储引擎**：SQLite (aiosqlite异步)
- **数据库版本**：v11
- **存储位置**：`AstrBot/data/xiuxian/xiuxian_data.db`
- **自动迁移**：插件升级时自动执行数据库迁移

---

## 🗺️ 后续规划

- [ ] 🔧 **炼器系统**：装备合成与强化
- [ ] 🎒 **宗门扩展**：宗门任务、宗门仓库、宗门等级
- [ ] 🛠️ **管理员工具**：GM指令修改游戏数据
- [ ] 🏦 **钱庄系统**：灵石存储利息
- [ ] 🎲 **娱乐玩法**：赌博、抽奖等小游戏

---

## 📝 更新日志

### v2.3.0 (最新)

**新增系统：**
- 📖 **功法系统**：学习功法永久提升攻击/防御/生命
- 💫 **Buff系统**：丹药提供临时战斗加成（持续多场战斗）
- ⚔️ **奇斗系统**：带灵石赌注的PVP，胜者获得灵石
- 💰 **玩家交易**：支持转账灵石和赠送物品
- 🏦 **宗门捐献**：贡献灵石获得宗门贡献度
- 🏆 **PVP排行**：新增胜场/胜率排行榜

**新增指令：**
- `奇斗 @某人 <灵石>` - 带赌注的切磋
- `转账 @某人 <金额>` - 灵石转账
- `赠送 @某人 <物品>` - 物品赠送
- `PVP排行` - 查看PVP排行榜
- `宗门捐献 <金额>` - 捐献灵石给宗门
- `我的buff` - 查看当前buff
- `我的功法` - 查看已学功法

**优化改进：**
- 切磋增加冷却时间（默认5分钟）
- PVP胜者获得修为奖励
- 战斗后自动消耗buff持续时间
- 功法添加实际属性加成效果

### v2.2.0

**新增系统：**
- 🏆 排行榜系统（境界/财富/战力三榜）
- 📋 每日任务系统（5任务+全勤奖励）
- 🌈 奇遇系统（每日3次，10种奇遇事件）
- ⚡ 天劫系统（4重天劫挑战）
- 📜 悬赏任务系统（7种难度）

**优化改进：**
- 签到刷新时间改为每日0点
- 完善帮助指令，涵盖40+游戏指令

---

## 🤝 贡献

欢迎通过以下方式贡献：

- 🐛 提交 Issue 报告 Bug
- 💡 提出功能建议
- 🔧 提交 Pull Request

---

## 📄 许可证

本项目采用 [AGPL-3.0](LICENSE) 许可证开源。
